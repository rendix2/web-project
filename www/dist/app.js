/*! For license information please see app.js.LICENSE.txt */
(()=>{var t={908:function(t,e,n){var i,a;(a="undefined"!=typeof window?window:this).JSON&&(void 0===(i=function(){return function(t){"use strict";var e={},n={},i={},a=new t.WeakMap;return e.formErrors=[],e.version="3.3.0",e.invalidNumberMessage="Please enter a valid value.",e.onDocumentReady=function(t){"loading"!==document.readyState?t.call(this):document.addEventListener("DOMContentLoaded",t)},e.getValue=function(t){var n;if(t){if(t.tagName){if("radio"===t.type){var i=t.form.elements;for(n=0;n<i.length;n++)if(i[n].name===t.name&&i[n].checked)return i[n].value;return null}if("file"===t.type)return t.files||t.value;if("select"===t.tagName.toLowerCase()){var a=t.selectedIndex,r=t.options,o=[];if("select-one"===t.type)return a<0?null:r[a].value;for(n=0;n<r.length;n++)r[n].selected&&o.push(r[n].value);return o}if(t.name&&"[]"===t.name.substr(-2)){for(i=t.form.elements[t.name].tagName?[t]:t.form.elements[t.name],o=[],n=0;n<i.length;n++)("checkbox"!==i[n].type||i[n].checked)&&o.push(i[n].value);return o}return"checkbox"===t.type?t.checked:"textarea"===t.tagName.toLowerCase()?t.value.replace("\r",""):t.value.replace("\r","").replace(/^\s+|\s+$/g,"")}return t[0]?e.getValue(t[0]):null}return null},e.getEffectiveValue=function(t,i){var a=e.getValue(t);if(t.getAttribute&&a===t.getAttribute("data-nette-empty-value")&&(a=""),i&&void 0===n[t.name]){n[t.name]=!0;var r={value:a};e.validateControl(t,null,!0,r),a=r.value,delete n[t.name]}return a},e.validateControl=function(t,n,i,a,r){var o=!n;t=t.tagName?t:t[0],n=n||JSON.parse(t.getAttribute("data-nette-rules")||"[]"),a=void 0===a?{value:e.getEffectiveValue(t)}:a,r=void 0===r?!e.validateRule(t,":filled",null,a):r;for(var s=0,l=n.length;s<l;s++){var u=n[s],d=u.op.match(/(~)?([^?]+)/),c=u.control?t.form.elements.namedItem(u.control):t;if(u.neg=d[1],u.op=d[2],u.condition=!!u.rules,c&&(!r||u.condition||":filled"===u.op)){c=c.tagName?c:c[0];var p=e.validateRule(c,u.op,u.arg,t===c?a:void 0);if(null!==p)if(u.neg&&(p=!p),u.condition&&p){if(!e.validateControl(t,u.rules,i,a,":blank"!==u.op&&r))return!1}else if(!u.condition&&!p){if(e.isDisabled(c))continue;if(!i){var h=Array.isArray(u.arg)?u.arg:[u.arg],f=u.msg.replace(/%(value|\d+)/g,(function(n,i){return e.getValue("value"===i?c:t.form.elements.namedItem(h[i].control))}));e.addError(c,f)}return!1}}}return!("number"===t.type&&!t.validity.valid&&(o&&!i&&e.addError(t,e.invalidNumberMessage),1))},e.validateForm=function(t,n){var i=t.form||t,a=!1;if(e.formErrors=[],i["nette-submittedBy"]&&null!==i["nette-submittedBy"].getAttribute("formnovalidate")){var r=JSON.parse(i["nette-submittedBy"].getAttribute("data-nette-validation-scope")||"[]");if(!r.length)return e.showFormErrors(i,[]),!0;a=new RegExp("^("+r.join("-|")+"-)")}var o,s,l={};for(o=0;o<i.elements.length;o++)if(!(s=i.elements[o]).tagName||s.tagName.toLowerCase()in{input:1,select:1,textarea:1,button:1}){if("radio"===s.type){if(l[s.name])continue;l[s.name]=!0}if(!(a&&!s.name.replace(/]\[|\[|]|$/g,"-").match(a)||e.isDisabled(s)||e.validateControl(s,null,n)||e.formErrors.length))return!1}var u=!e.formErrors.length;return e.showFormErrors(i,e.formErrors),u},e.isDisabled=function(t){if("radio"===t.type){for(var e=0,n=t.form.elements;e<n.length;e++)if(n[e].name===t.name&&!n[e].disabled)return!1;return!0}return t.disabled},e.addError=function(t,n){e.formErrors.push({element:t,message:n})},e.showFormErrors=function(t,n){for(var i,a=[],r=0;r<n.length;r++){var o=n[r].element,s=n[r].message;a.indexOf(s)<0&&(a.push(s),!i&&o.focus&&(i=o))}a.length&&e.showModal(a.join("\n"),(function(){i&&i.focus()}))},e.showModal=function(t,e){var n=document.createElement("dialog"),i=navigator.userAgentData;if(i&&n.showModal&&i.brands.some((function(t){return"Opera"===t.brand||"Chromium"===t.brand&&i.mobile}))){var a=document.createElement("style");a.innerText=".netteFormsModal { text-align: center; margin: auto; border: 2px solid black; padding: 1rem } .netteFormsModal button { padding: .1em 2em }";var r=document.createElement("button");return r.innerText="OK",r.onclick=function(){n.remove(),e()},n.setAttribute("class","netteFormsModal"),n.innerText=t+"\n\n",n.appendChild(a),n.appendChild(r),document.body.appendChild(n),void n.showModal()}alert(t),e()},e.validateRule=function(t,n,i,a){a=void 0===a?{value:e.getEffectiveValue(t,!0)}:a,":"===n.charAt(0)&&(n=n.substr(1)),n=(n=n.replace("::","_")).replace(/\\/g,"");for(var r=Array.isArray(i)?i.slice(0):[i],o=0,s=r.length;o<s;o++)if(r[o]&&r[o].control){var l=t.form.elements.namedItem(r[o].control);r[o]=l===t?a.value:e.getEffectiveValue(l,!0)}return e.validators[n]?e.validators[n](t,Array.isArray(i)?r:r[0],a.value,a):null},e.validators={filled:function(e,n,i){return!("number"!==e.type||!e.validity.badInput)||""!==i&&!1!==i&&null!==i&&(!Array.isArray(i)||!!i.length)&&(!t.FileList||!(i instanceof t.FileList)||i.length)},blank:function(t,n,i){return!e.validators.filled(t,n,i)},valid:function(t){return e.validateControl(t,null,!0)},equal:function(t,e,n){if(void 0===e)return null;var i=function(t){return"number"==typeof t||"string"==typeof t?""+t:!0===t?"1":""};n=Array.isArray(n)?n:[n],e=Array.isArray(e)?e:[e];t:for(var a=0,r=n.length;a<r;a++){for(var o=0,s=e.length;o<s;o++)if(i(n[a])===i(e[o]))continue t;return!1}return n.length>0},notEqual:function(t,n,i){return void 0===n?null:!e.validators.equal(t,n,i)},minLength:function(t,e,n){if("number"===t.type){if(t.validity.tooShort)return!1;if(t.validity.badInput)return null}return n.length>=e},maxLength:function(t,e,n){if("number"===t.type){if(t.validity.tooLong)return!1;if(t.validity.badInput)return null}return n.length<=e},length:function(t,e,n){if("number"===t.type){if(t.validity.tooShort||t.validity.tooLong)return!1;if(t.validity.badInput)return null}return(null===(e=Array.isArray(e)?e:[e,e])[0]||n.length>=e[0])&&(null===e[1]||n.length<=e[1])},email:function(t,e,n){return/^("([ !#-[\]-~]|\\[ -~])+"|[-a-z0-9!#$%&'*+/=?^_`{|}~]+(\.[-a-z0-9!#$%&'*+/=?^_`{|}~]+)*)@([0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)+[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?$/i.test(n)},url:function(t,e,n,i){return/^[a-z\d+.-]+:/.test(n)||(n="https://"+n),!!/^https?:\/\/((([-_0-9a-z\u00C0-\u02FF\u0370-\u1EFF]+\.)*[0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)?[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\[[0-9a-f:]{3,39}\])(:\d{1,5})?(\/\S*)?$/i.test(n)&&(i.value=n,!0)},regexp:function(t,e,n){var i="string"==typeof e&&e.match(/^\/(.*)\/([imu]*)$/);try{return i&&new RegExp(i[1],i[2].replace("u","")).test(n)}catch(t){}},pattern:function(e,n,i,a,r){if("string"!=typeof n)return null;try{try{var o=new RegExp("^(?:"+n+")$",r?"ui":"u")}catch(t){o=new RegExp("^(?:"+n+")$",r?"i":"")}if(t.FileList&&i instanceof FileList){for(var s=0;s<i.length;s++)if(!o.test(i[s].name))return!1;return!0}return o.test(i)}catch(t){}},patternCaseInsensitive:function(t,n,i){return e.validators.pattern(t,n,i,null,!0)},numeric:function(t,e,n){return("number"!==t.type||!t.validity.badInput)&&/^[0-9]+$/.test(n)},integer:function(t,e,n){return("number"!==t.type||!t.validity.badInput)&&/^-?[0-9]+$/.test(n)},float:function(t,e,n,i){return!("number"===t.type&&t.validity.badInput||(n=n.replace(/ +/g,"").replace(/,/g,"."),!/^-?[0-9]*\.?[0-9]+$/.test(n)||(i.value=n,0)))},min:function(t,e,n){if("number"===t.type){if(t.validity.rangeUnderflow)return!1;if(t.validity.badInput)return null}return null===e||parseFloat(n)>=e},max:function(t,e,n){if("number"===t.type){if(t.validity.rangeOverflow)return!1;if(t.validity.badInput)return null}return null===e||parseFloat(n)<=e},range:function(t,e,n){if("number"===t.type){if(t.validity.rangeUnderflow||t.validity.rangeOverflow)return!1;if(t.validity.badInput)return null}return Array.isArray(e)?(null===e[0]||parseFloat(n)>=e[0])&&(null===e[1]||parseFloat(n)<=e[1]):null},submitted:function(t){return t.form["nette-submittedBy"]===t},fileSize:function(e,n,i){if(t.FileList)for(var a=0;a<i.length;a++)if(i[a].size>n)return!1;return!0},mimeType:function(e,n,i){for(var a=0,r=(n=Array.isArray(n)?n:[n]).length,o=[];a<r;a++)o.push("^"+n[a].replace(/([^\w])/g,"\\$1").replace("\\*",".*")+"$");if(o=new RegExp(o.join("|")),t.FileList&&i instanceof FileList)for(a=0;a<i.length;a++){if(i[a].type&&!o.test(i[a].type))return!1;if(e.validity.badInput)return null}return!0},image:function(t,n,i){return e.validators.mimeType(t,["image/gif","image/png","image/jpeg","image/webp"],i)},static:function(t,e){return e}},e.toggleForm=function(t,n){var a;for(i={},a=0;a<t.elements.length;a++)t.elements[a].tagName.toLowerCase()in{input:1,select:1,textarea:1,button:1}&&e.toggleControl(t.elements[a],null,null,!n);for(a in i)e.toggle(a,i[a].state,i[a].elem,n)},e.toggleControl=function(t,n,r,o,s,l){n=n||JSON.parse(t.getAttribute("data-nette-rules")||"[]"),s=void 0===s?{value:e.getEffectiveValue(t)}:s,l=void 0===l?!e.validateRule(t,":filled",null,s):l;for(var u,d=!1,c=function(n){e.toggleForm(t.form,n)},p=0,h=n.length;p<h;p++){var f=n[p],m=f.op.match(/(~)?([^?]+)/),v=f.control?t.form.elements.namedItem(f.control):t;if(f.neg=m[1],f.op=m[2],f.condition=!!f.rules,v&&(!l||f.condition||":filled"===f.op)){if(u=r,!1!==r){if(null===(u=e.validateRule(v,f.op,f.arg,t===v?s:void 0)))continue;f.neg&&(u=!u),f.condition||(r=u)}if(f.condition&&e.toggleControl(t,f.rules,u,o,s,":blank"!==f.op&&l)||f.toggle){if(d=!0,o)for(var g=v.tagName?v.name:v[0].name,b=v.tagName?v.form.elements:v,y=0;y<b.length;y++)b[y].name!==g||a.has(b[y])||(b[y].addEventListener("change",c),a.set(b[y],null));for(var E in f.toggle||[])i[E]=i[E]||{elem:t},i[E].state=i[E].state||(f.toggle[E]?u:!u)}}}return d},e.toggle=function(t,e,n,i){/^\w[\w.:-]*$/.test(t)&&(t="#"+t);for(var a=document.querySelectorAll(t),r=0;r<a.length;r++)a[r].hidden=!e},e.compactCheckboxes=function(t){var e,n,i,a={};for(n=0;n<t.elements.length;n++)(i=t.elements[n]).tagName&&"input"===i.tagName.toLowerCase()&&"checkbox"===i.type&&(i.name&&"[]"===i.name.substr(-2)&&(e=i.name.substr(0,i.name.length-2),i.removeAttribute("name"),i.setAttribute("data-nette-name",e)),(e=i.getAttribute("data-nette-name"))&&(a[e]=a[e]||[],i.checked&&!i.disabled&&a[e].push(i.value)));for(e in a)void 0===t.elements[e]&&((i=document.createElement("input")).setAttribute("name",e),i.setAttribute("type","hidden"),t.appendChild(i)),t.elements[e].value=a[e].join(","),t.elements[e].disabled=0===a[e].length},e.initForm=function(t){"get"===t.method&&t.hasAttribute("data-nette-compact")&&t.addEventListener("submit",(function(){e.compactCheckboxes(t)}));t:{for(var n=0;n<t.elements.length;n++)if(t.elements[n].getAttribute("data-nette-rules"))break t;return}e.toggleForm(t),t.noValidate||(t.noValidate=!0,t.addEventListener("submit",(function(n){e.validateForm(t)||(n.stopPropagation(),n.preventDefault())})))},e.initOnLoad=function(){e.onDocumentReady((function(){for(var t=0;t<document.forms.length;t++)e.initForm(document.forms[t]);document.body.addEventListener("click",(function(t){for(var e=t.target;e;){if(e.form&&e.type in{submit:1,image:1}){e.form["nette-submittedBy"]=e;break}e=e.parentNode}}))}))},e.webalize=function(t){t=t.toLowerCase();var n,i="";for(n=0;n<t.length;n++)i+=e.webalizeTable[t.charAt(n)]||t.charAt(n);return i.replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")},e.webalizeTable={á:"a",ä:"a",č:"c",ď:"d",é:"e",ě:"e",í:"i",ľ:"l",ň:"n",ó:"o",ô:"o",ř:"r",š:"s",ť:"t",ú:"u",ů:"u",ý:"y",ž:"z"},e}(a)}.call(e,n,e,t))||(t.exports=i))}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}(()=>{"use strict";n(908),LiveForm.setOptions({messageErrorPrefix:"Chyba: ",wait:500});const t=t=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()};class e extends Error{}const i=(t,n)=>{if(!t)throw new e("Assertion failed"+(void 0!==n?`: ${n}`:"."))};class a extends EventTarget{constructor(t){super(),this.naja=t,this.selector=".ajax",this.allowedOrigins=[window.location.origin],this.handler=this.handleUI.bind(this),t.addEventListener("init",this.initialize.bind(this))}initialize(){t((()=>this.bindUI(window.document.body))),this.naja.snippetHandler.addEventListener("afterUpdate",(t=>{const{snippet:e}=t.detail;this.bindUI(e)}))}bindUI(t){const e=[`a${this.selector}`,`input[type="submit"]${this.selector}`,`input[type="image"]${this.selector}`,`button[type="submit"]${this.selector}`,`form${this.selector} input[type="submit"]`,`form${this.selector} input[type="image"]`,`form${this.selector} button[type="submit"]`].join(", "),n=t=>{t.removeEventListener("click",this.handler),t.addEventListener("click",this.handler)},i=t.querySelectorAll(e);for(let t=0;t<i.length;t++)n(i.item(t));t.matches(e)&&n(t);const a=t=>{t.removeEventListener("submit",this.handler),t.addEventListener("submit",this.handler)};t.matches(`form${this.selector}`)&&a(t);const r=t.querySelectorAll(`form${this.selector}`);for(let t=0;t<r.length;t++)a(r.item(t))}handleUI(t){const e=t;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||e.button)return;const n=t.currentTarget,i=this.naja.prepareOptions(),a=()=>{};"submit"===t.type?this.submitForm(n,i,t).catch(a):"click"===t.type&&this.clickElement(n,i,e).catch(a)}async clickElement(t,e={},n){let a,r="GET",o="";if(!this.dispatchEvent(new CustomEvent("interaction",{cancelable:!0,detail:{element:t,originalEvent:n,options:e}})))return n?.preventDefault(),{};if("A"===t.tagName)i(t instanceof HTMLAnchorElement),r="GET",o=t.href,a=null;else if("INPUT"===t.tagName||"BUTTON"===t.tagName){i(t instanceof HTMLInputElement||t instanceof HTMLButtonElement);const{form:e}=t;if(r=t.getAttribute("formmethod")?.toUpperCase()??e?.getAttribute("method")?.toUpperCase()??"GET",o=t.getAttribute("formaction")??e?.getAttribute("action")??window.location.pathname+window.location.search,a=new FormData(e??void 0),"submit"===t.type&&""!==t.name)a.append(t.name,t.value||"");else if("image"===t.type){const e=t.getBoundingClientRect(),i=""!==t.name?`${t.name}.`:"";a.append(`${i}x`,Math.max(0,Math.floor(void 0!==n?n.pageX-e.left:0))),a.append(`${i}y`,Math.max(0,Math.floor(void 0!==n?n.pageY-e.top:0)))}}if(!this.isUrlAllowed(o))throw new Error(`Cannot dispatch async request, URL is not allowed: ${o}`);return n?.preventDefault(),this.naja.makeRequest(r,o,a,e)}async submitForm(t,e={},n){if(!this.dispatchEvent(new CustomEvent("interaction",{cancelable:!0,detail:{element:t,originalEvent:n,options:e}})))return n?.preventDefault(),{};const i=t.getAttribute("method")?.toUpperCase()??"GET",a=t.getAttribute("action")??window.location.pathname+window.location.search,r=new FormData(t);if(!this.isUrlAllowed(a))throw new Error(`Cannot dispatch async request, URL is not allowed: ${a}`);return n?.preventDefault(),this.naja.makeRequest(i,a,r,e)}isUrlAllowed(t){const e=new URL(t,location.href);return"null"!==e.origin&&this.allowedOrigins.includes(e.origin)}}class r{constructor(t){this.naja=t,t.addEventListener("init",this.initialize.bind(this)),t.uiHandler.addEventListener("interaction",this.processForm.bind(this))}initialize(){t((()=>this.initForms(window.document.body))),this.naja.snippetHandler.addEventListener("afterUpdate",(t=>{const{snippet:e}=t.detail;this.initForms(e)}))}initForms(t){const e=this.netteForms||window.Nette;if(e){"form"===t.tagName&&e.initForm(t);const n=t.querySelectorAll("form");for(let t=0;t<n.length;t++)e.initForm(n.item(t))}}processForm(t){const{element:e,originalEvent:n}=t.detail,i=e;void 0!==i.form&&null!==i.form&&(i.form["nette-submittedBy"]=e);const a=this.netteForms||window.Nette;"FORM"!==e.tagName&&!e.form||!a||a.validateForm(e)||(n&&(n.stopImmediatePropagation(),n.preventDefault()),t.preventDefault())}}class o extends EventTarget{constructor(t){super(),this.naja=t,t.uiHandler.addEventListener("interaction",(t=>{const{element:e,options:n}=t.detail;if(e&&(e.hasAttribute("data-naja-force-redirect")||e.form?.hasAttribute("data-naja-force-redirect"))){const t=e.getAttribute("data-naja-force-redirect")??e.form?.getAttribute("data-naja-force-redirect");n.forceRedirect="off"!==t}})),t.addEventListener("success",(t=>{const{payload:e,options:n}=t.detail;e.redirect&&(this.makeRedirect(e.redirect,n.forceRedirect??!1,n),t.stopImmediatePropagation())})),this.locationAdapter={assign:t=>window.location.assign(t)}}makeRedirect(t,e,n={}){t instanceof URL&&(t=t.href);let i=e||!this.naja.uiHandler.isUrlAllowed(t);this.dispatchEvent(new CustomEvent("redirect",{cancelable:!0,detail:{url:t,isHardRedirect:i,setHardRedirect(t){i=!!t},options:n}}))&&(i?this.locationAdapter.assign(t):this.naja.makeRequest("GET",t,null,n))}}class s extends EventTarget{constructor(t){super(),this.naja=t,this.op={replace:(t,e)=>{t.innerHTML=e},prepend:(t,e)=>t.insertAdjacentHTML("afterbegin",e),append:(t,e)=>t.insertAdjacentHTML("beforeend",e)},t.addEventListener("success",(t=>{const{options:e,payload:n}=t.detail;n.snippets&&this.updateSnippets(n.snippets,!1,e)}))}static findSnippets(t){const e={},n=window.document.querySelectorAll('[id^="snippet-"]');for(let i=0;i<n.length;i++){const a=n.item(i);(t?.(a)??1)&&(e[a.id]=a.innerHTML)}return e}updateSnippets(t,e=!1,n={}){Object.keys(t).forEach((i=>{const a=document.getElementById(i);a&&this.updateSnippet(a,t[i],e,n)}))}updateSnippet(t,e,n,i){let a=this.op.replace;!t.hasAttribute("data-naja-snippet-prepend")&&!t.hasAttribute("data-ajax-prepend")||n?!t.hasAttribute("data-naja-snippet-append")&&!t.hasAttribute("data-ajax-append")||n||(a=this.op.append):a=this.op.prepend,this.dispatchEvent(new CustomEvent("beforeUpdate",{cancelable:!0,detail:{snippet:t,content:e,fromCache:n,operation:a,changeOperation(t){a=t},options:i}}))&&("title"===t.tagName.toLowerCase()?document.title=e:a(t,e),this.dispatchEvent(new CustomEvent("afterUpdate",{cancelable:!0,detail:{snippet:t,content:e,fromCache:n,operation:a,options:i}})))}}class l extends EventTarget{constructor(t){super(),this.naja=t,this.initialized=!1,this.popStateHandler=this.handlePopState.bind(this),t.addEventListener("init",this.initialize.bind(this)),t.addEventListener("before",this.saveUrl.bind(this)),t.addEventListener("before",this.replaceInitialState.bind(this)),t.addEventListener("success",this.pushNewState.bind(this)),t.uiHandler.addEventListener("interaction",this.configureMode.bind(this)),this.historyAdapter={replaceState:(t,e,n)=>window.history.replaceState(t,e,n),pushState:(t,e,n)=>window.history.pushState(t,e,n)}}set uiCache(t){console.warn("Naja: HistoryHandler.uiCache is deprecated, use options.snippetCache instead."),this.naja.defaultOptions.snippetCache=t}handlePopState(t){const{state:e}=t;if("naja"!==e?.source)return;const n=this.naja.prepareOptions();this.dispatchEvent(new CustomEvent("restoreState",{detail:{state:e,options:n}}))}initialize(){window.addEventListener("popstate",this.popStateHandler)}saveUrl(t){const{url:e,options:n}=t.detail;n.href??=e}replaceInitialState(e){const{options:n}=e.detail;!1===l.normalizeMode(n.history)||this.initialized||(t((()=>this.historyAdapter.replaceState(this.buildState(window.location.href,n),window.document.title,window.location.href))),this.initialized=!0)}configureMode(t){const{element:e,options:n}=t.detail;if(e&&(e.hasAttribute("data-naja-history")||e.form?.hasAttribute("data-naja-history"))){const t=e.getAttribute("data-naja-history")??e.form?.getAttribute("data-naja-history");n.history=l.normalizeMode(t)}}static normalizeMode(t){return"off"!==t&&!1!==t&&("replace"!==t||"replace")}pushNewState(t){const{payload:e,options:n}=t.detail,i=l.normalizeMode(n.history);if(!1===i)return;e.postGet&&e.url&&(n.href=e.url);const a="replace"===i?"replaceState":"pushState";this.historyAdapter[a](this.buildState(n.href,n),window.document.title,n.href)}buildState(t,e){const n={source:"naja",href:t};return this.dispatchEvent(new CustomEvent("buildState",{detail:{state:n,options:e}})),n}}class u extends EventTarget{constructor(t){super(),this.naja=t,this.storages={off:new d(t),history:new c,session:new p},t.uiHandler.addEventListener("interaction",this.configureCache.bind(this)),t.historyHandler.addEventListener("buildState",this.buildHistoryState.bind(this)),t.historyHandler.addEventListener("restoreState",this.restoreHistoryState.bind(this))}resolveStorage(t){let e;return e=!0===t||void 0===t?"history":!1===t?"off":t,this.storages[e]}configureCache(t){const{element:e,options:n}=t.detail;if(e&&(e.hasAttribute("data-naja-snippet-cache")||e.form?.hasAttribute("data-naja-snippet-cache")||e.hasAttribute("data-naja-history-cache")||e.form?.hasAttribute("data-naja-history-cache"))){const t=e.getAttribute("data-naja-snippet-cache")??e.form?.getAttribute("data-naja-snippet-cache")??e.getAttribute("data-naja-history-cache")??e.form?.getAttribute("data-naja-history-cache");n.snippetCache=t}}buildHistoryState(t){const{state:e,options:n}=t.detail;"historyUiCache"in n&&(console.warn("Naja: options.historyUiCache is deprecated, use options.snippetCache instead."),n.snippetCache=n.historyUiCache);const i=s.findSnippets((t=>!(t.hasAttribute("data-naja-history-nocache")||t.hasAttribute("data-history-nocache")||t.hasAttribute("data-naja-snippet-cache")&&"off"===t.getAttribute("data-naja-snippet-cache"))));if(!this.dispatchEvent(new CustomEvent("store",{cancelable:!0,detail:{snippets:i,state:e,options:n}})))return;const a=this.resolveStorage(n.snippetCache);e.snippets={storage:a.type,key:a.store(i)}}restoreHistoryState(t){const{state:e,options:n}=t.detail;if(void 0===e.snippets)return;if(n.snippetCache=e.snippets.storage,!this.dispatchEvent(new CustomEvent("fetch",{cancelable:!0,detail:{state:e,options:n}})))return;const i=this.resolveStorage(n.snippetCache).fetch(e.snippets.key,e,n);null!==i&&this.dispatchEvent(new CustomEvent("restore",{cancelable:!0,detail:{snippets:i,state:e,options:n}}))&&(this.naja.snippetHandler.updateSnippets(i,!0,n),this.naja.scriptLoader.loadScripts(i))}}class d{constructor(t){this.naja=t,this.type="off"}store(){return null}fetch(t,e,n){return this.naja.makeRequest("GET",e.href,null,{...n,history:!1,snippetCache:!1}),null}}class c{constructor(){this.type="history"}store(t){return t}fetch(t){return t}}class p{constructor(){this.type="session"}store(t){const e=Math.random().toString(36).substring(2,8);return window.sessionStorage.setItem(e,JSON.stringify(t)),e}fetch(t){const e=window.sessionStorage.getItem(t);return null===e?null:JSON.parse(e)}}class h{constructor(e){this.loadedScripts=new Set,e.addEventListener("init",(()=>{t((()=>{document.querySelectorAll("script[data-naja-script-id]").forEach((t=>{const e=t.getAttribute("data-naja-script-id");null!==e&&""!==e&&this.loadedScripts.add(e)}))})),e.addEventListener("success",(t=>{const{payload:e}=t.detail;e.snippets&&this.loadScripts(e.snippets)}))}))}loadScripts(t){Object.keys(t).forEach((e=>{const n=t[e];if(!/<script/i.test(n))return;const i=window.document.createElement("div");i.innerHTML=n;const a=i.querySelectorAll("script");for(let t=0;t<a.length;t++){const e=a.item(t),n=e.getAttribute("data-naja-script-id");if(null!==n&&""!==n&&this.loadedScripts.has(n))continue;const i=window.document.createElement("script");if(i.innerHTML=e.innerHTML,e.hasAttributes()){const t=e.attributes;for(let e=0;e<t.length;e++){const n=t[e].name;i.setAttribute(n,t[e].value)}}window.document.head.appendChild(i).parentNode.removeChild(i),null!==n&&""!==n&&this.loadedScripts.add(n)}}))}}class f extends EventTarget{constructor(t,e,n,i,d,c,p){super(),this.VERSION=2,this.initialized=!1,this.extensions=[],this.defaultOptions={},this.uiHandler=new(t??a)(this),this.redirectHandler=new(e??o)(this),this.snippetHandler=new(n??s)(this),this.formsHandler=new(i??r)(this),this.historyHandler=new(d??l)(this),this.snippetCache=new(c??u)(this),this.scriptLoader=new(p??h)(this)}registerExtension(t){this.initialized&&t.initialize(this),this.extensions.push(t)}initialize(t={}){if(this.initialized)throw new Error("Cannot initialize Naja, it is already initialized.");this.defaultOptions=this.prepareOptions(t),this.extensions.forEach((t=>t.initialize(this))),this.dispatchEvent(new CustomEvent("init",{detail:{defaultOptions:this.defaultOptions}})),this.initialized=!0}prepareOptions(t){return{...this.defaultOptions,...t,fetch:{...this.defaultOptions.fetch,...t?.fetch}}}async makeRequest(t,e,n=null,i={}){"string"==typeof e&&(e=new URL(e,location.href)),i=this.prepareOptions(i);const a=new Headers(i.fetch.headers||{}),r=this.transformData(e,t,n),o=new AbortController,s=new Request(e.toString(),{credentials:"same-origin",...i.fetch,method:t,headers:a,body:r,signal:o.signal});if(s.headers.set("X-Requested-With","XMLHttpRequest"),s.headers.set("Accept","application/json"),!this.dispatchEvent(new CustomEvent("before",{cancelable:!0,detail:{request:s,method:t,url:e.toString(),data:n,options:i}})))return{};const l=window.fetch(s);let u,d;this.dispatchEvent(new CustomEvent("start",{detail:{request:s,promise:l,abortController:o,options:i}}));try{if(u=await l,!u.ok)throw new m(u);d=await u.json()}catch(t){if("AbortError"===t.name)return this.dispatchEvent(new CustomEvent("abort",{detail:{request:s,error:t,options:i}})),this.dispatchEvent(new CustomEvent("complete",{detail:{request:s,response:u,payload:void 0,error:t,options:i}})),{};throw this.dispatchEvent(new CustomEvent("error",{detail:{request:s,response:u,error:t,options:i}})),this.dispatchEvent(new CustomEvent("complete",{detail:{request:s,response:u,payload:void 0,error:t,options:i}})),t}return this.dispatchEvent(new CustomEvent("payload",{detail:{request:s,response:u,payload:d,options:i}})),this.dispatchEvent(new CustomEvent("success",{detail:{request:s,response:u,payload:d,options:i}})),this.dispatchEvent(new CustomEvent("complete",{detail:{request:s,response:u,payload:d,error:void 0,options:i}})),d}appendToQueryString(t,e,n){if(null!=n)if(Array.isArray(n)||Object.getPrototypeOf(n)===Object.prototype)for(const[i,a]of Object.entries(n))this.appendToQueryString(t,`${e}[${i}]`,a);else t.append(e,String(n))}transformData(t,e,n){const i=["GET","HEAD"].includes(e.toUpperCase());if(i&&n instanceof FormData){for(const[e,i]of n)null!=i&&t.searchParams.append(e,String(i));return null}if(null!==n&&Object.getPrototypeOf(n)===Object.prototype||Array.isArray(n)){const e=i?t.searchParams:new URLSearchParams;for(const[t,i]of Object.entries(n))this.appendToQueryString(e,t,i);return i?null:e}return n}}class m extends Error{constructor(t){const e=`HTTP ${t.status}: ${t.statusText}`;super(e),this.name=this.constructor.name,this.stack=new Error(e).stack,this.response=t}}const v=new f;v.registerExtension(new class{constructor(){this.abortControllers=new Set}initialize(t){t.uiHandler.addEventListener("interaction",this.checkAbortable.bind(this)),t.addEventListener("init",this.onInitialize.bind(this)),t.addEventListener("start",this.saveAbortController.bind(this)),t.addEventListener("complete",this.removeAbortController.bind(this))}onInitialize(){document.addEventListener("keydown",(t=>{if("Escape"===t.key&&!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)){for(const t of this.abortControllers)t.abort();this.abortControllers.clear()}}))}checkAbortable(t){const{element:e,options:n}=t.detail;(e.hasAttribute("data-naja-abort")||e.form?.hasAttribute("data-naja-abort"))&&(n.abort="off"!==(e.getAttribute("data-naja-abort")??e.form?.getAttribute("data-naja-abort")))}saveAbortController(t){const{abortController:e,options:n}=t.detail;!1!==n.abort&&(this.abortControllers.add(e),n.clearAbortExtension=()=>this.abortControllers.delete(e))}removeAbortController(t){const{options:e}=t.detail;!1!==e.abort&&e.clearAbortExtension&&e.clearAbortExtension()}}),v.registerExtension(new class{constructor(){this.abortControllers=new Map}initialize(t){t.uiHandler.addEventListener("interaction",this.checkUniqueness.bind(this)),t.addEventListener("start",this.abortPreviousRequest.bind(this)),t.addEventListener("complete",this.clearRequest.bind(this))}checkUniqueness(t){const{element:e,options:n}=t.detail,i=e.getAttribute("data-naja-unique")??e.form?.getAttribute("data-naja-unique");n.unique="off"!==i&&(i??"default")}abortPreviousRequest(t){const{abortController:e,options:n}=t.detail;!1!==n.unique&&(this.abortControllers.get(n.unique??"default")?.abort(),this.abortControllers.set(n.unique??"default",e))}clearRequest(t){const{request:e,options:n}=t.detail;e.signal.aborted||!1===n.unique||this.abortControllers.delete(n.unique??"default")}})})()})();